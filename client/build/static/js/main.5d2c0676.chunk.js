(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{203:function(e,t,a){},212:function(e,t,a){"use strict";a.r(t);var n,r,i,s,c,l=a(0),u=a(15),o=a.n(u),m=a(42),d=a(30),b=a(19),j=a(102),v=a(100),p=a(5),O=a(101),f=a(16),g=a.n(f),h=a(26),x=a(63),y=a(27),M=a(22),w=a(257),S=a(9),N=function(e){var t=e.users,a=e.email,n=e.name,r=e.selectedMail,i=e.deleteUser,s=Object(l.useCallback)((function(e,t){r(e,t)}),[r]),c=Object(l.useCallback)(Object(h.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(a);case 2:window.location.href=window.location.href;case 3:case"end":return e.stop()}}),e)}))),[i,a]);return Object(S.jsxs)("div",{className:"user-welcome",style:e.style,children:[Object(S.jsxs)("div",{className:"user-heading",children:[Object(S.jsxs)("p",{style:{margin:"unset"},children:["Hello, ",n]}),Object(S.jsx)(w.a,{className:"leave",size:"small",variant:"outlined",onClick:c,children:"Leave Chat?"})]}),Object(S.jsx)("div",{className:"select-user",children:t.map((function(e,t){return e.email!==a?Object(S.jsx)("div",{className:"users",onClick:function(){return s(e.email,e.name)},children:e.name},t):""}))})]})},k=a(60),$=a(255),T=a(96),U=a.n(T),q=a(24),C=a(25),Q=Object(C.a)(n||(n=Object(q.a)(["\nquery {\n\tmessages {\n\t\tid\n\t\tmessage\n\t\tsenderMail\n\t\treceiverMail\n\t\ttimestamp\n\t\tusers {\n\t\t\tname\n\t\t\temail\n\t\t}\n\t}\n}\n"]))),D=Object(C.a)(r||(r=Object(q.a)(["\nmutation(\n$message: String!\n$senderMail: String!\n$receiverMail: String!\n$timestamp: Float!\n) {\n\tcreateMessage(\n\tmessage: $message\n\tsenderMail: $senderMail\n\treceiverMail: $receiverMail\n\ttimestamp: $timestamp\n\t) {\n\t\tmessage\n\t\tsenderMail\n\t\treceiverMail\n\t\tid\n\t\ttimestamp\n\t\tusers {\n\t\t\tname\n\t\t\temail\n\t\t}\n\t}\n}\n"]))),E=Object(C.a)(i||(i=Object(q.a)(["\nmutation($email: String!, $receiverMail: String!) {\n\tuserTyping(email: $email, receiverMail: $receiverMail)\n}\n"]))),I=Object(C.a)(s||(s=Object(q.a)(["\nsubscription($receiverMail: String!) {\n\tnewMessage(receiverMail: $receiverMail) {\n\t\tmessage\n\t\tsenderMail\n\t\treceiverMail\n\t\tid\n\t\ttimestamp\n\t\tusers {\n\t\t\tname\n\t\t\temail\n\t\t}\n\t}\n}\n"]))),z=Object(C.a)(c||(c=Object(q.a)(["\nsubscription($receiverMail: String!) {\n\tuserTyping(receiverMail: $receiverMail)\n}\n"]))),W=Object(k.flowRight)(Object(d.b)(Q,{name:"message"}),Object(d.b)(D,{name:"createMessage"}),Object(d.b)(E,{name:"userTyping"}))((function(e){var t=Object(l.useRef)(null),a=Object(l.useState)(""),n=Object(M.a)(a,2),r=n[0],i=n[1],s=Object(l.useState)(""),c=Object(M.a)(s,2),u=c[0],o=c[1],m=Object(l.useState)(null),d=Object(M.a)(m,2),b=d[0],j=d[1];Object(l.useEffect)((function(){e.message.subscribeToMore({document:I,variables:{receiverMail:e.email},updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.newMessage;return e.messages.find((function(e){return e.id===n.id}))?e:Object(y.a)(Object(y.a)({},e),{},{messages:[].concat(Object(x.a)(e.messages),[n])})}}),e.message.subscribeToMore({document:z,variables:{receiverMail:e.email},updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.userTyping;o(n)}}),t.current&&v()}));var v=function(){t.current.scrollIntoView()},p=function(){var t=Object(h.a)(g.a.mark((function t(a){var n,r,s;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i(a.target.value),n=e.email,r=e.receiverMail,t.next=4,e.userTyping({variables:{email:n,receiverMail:r}});case 4:s=function(){var t=Object(h.a)(g.a.mark((function t(){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.userTyping({variables:{email:"email",receiverMail:r}});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),clearTimeout(b),j(setTimeout(s,2e3));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),O=function(){var t=Object(h.a)(g.a.mark((function t(a,n,r){var s;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i(""),a.preventDefault(),s=e.receiverMail,n.length){t.next=5;break}return t.abrupt("return",null);case 5:return t.next=7,e.createMessage({variables:{receiverMail:s,senderMail:r,message:n,timestamp:Date.now()},update:function(e,t){var a=t.data.createMessage,n=e.readQuery({query:Q});n.messages.push(a),e.writeQuery({query:Q,data:n})}});case 7:return t.next=9,e.userTyping({variables:{email:"email",receiverMail:s}});case 9:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),f=e.message,w=f.error,N=f.loading,k=f.messages,T=e.email,q=e.receiverMail,C=e.receiverName,D=e.userLeft;return w||N?null:Object(S.jsxs)("div",{className:"personal-chat",style:e.style,children:[Object(S.jsxs)("div",{className:"chats-header",children:[Object(S.jsxs)("div",{className:"back-button",onClick:function(){e.setStyle()},children:[Object(S.jsx)("div",{className:"bar1"}),Object(S.jsx)("div",{className:"bar2"}),Object(S.jsx)("div",{className:"bar3"})]}),Object(S.jsx)("div",{className:"user-typing",children:u&&u===q?"".concat(C," is typing"):C})]}),Object(S.jsxs)("div",{className:"all-messages",children:[k.map((function(e){return e.senderMail===T&&e.receiverMail===q||e.senderMail===q&&e.receiverMail===T?Object(S.jsxs)("div",{className:e.users.map((function(e){return e.email===q?"receiver":"sender"})),children:[Object(S.jsx)("div",{className:"sender-name",children:e.users.map((function(e){return e.name}))}),e.message," ",Object(S.jsxs)("span",{className:"time",children:[" ",U()(e.timestamp).fromNow()]})]},e.id):""})),D&&D===q?Object(S.jsxs)("div",{children:[C," has left the chat. "]}):null]}),q&&C&&!D?Object(S.jsx)("form",{onSubmit:function(e){return O(e,r,T)},ref:t,className:"chat-box",children:Object(S.jsx)($.a,{style:{margin:10},placeholder:"Say something to "+C,fullWidth:!0,name:"message",value:r,onChange:p,margin:"normal",size:"small",variant:"outlined"})}):Object(S.jsx)("div",{className:"select-message",children:"Select a logged in user from the left panel"})]})})),J=a(55),L=a(254),R=a(214),F=a(250),P=a(252),V=a(249),B=a(253),H=a(258),Y=a(256),A=a(251),G=a(72),K=a.n(G);function X(){return Object(S.jsxs)(R.a,{variant:"body2",color:"textSecondary",align:"center",children:["Copyright \xa9 ",Object(S.jsx)(F.a,{color:"inherit",href:"manojspace.com",children:"manoj"})," ",(new Date).getFullYear(),"."]})}var Z,_,ee,te,ae,ne=Object(A.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center",marginLeft:"15px",marginRight:"15px"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},error:{color:"red"}}}));function re(e){var t=ne(),a=Object(l.useState)({name:"",email:""}),n=Object(M.a)(a,2),r=n[0],i=n[1],s=Object(l.useState)(""),c=Object(M.a)(s,2),u=c[0],o=c[1],m=Object(l.useState)(!1),d=Object(M.a)(m,2),b=d[0],j=d[1],v=function(e){i(Object(y.a)(Object(y.a)({},r),{},Object(J.a)({},e.target.name,e.target.value)))},p=function(){var t=Object(h.a)(g.a.mark((function t(){var a,n,i;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.name,n=r.email,i=e.users.some((function(e){return e.email===n})),a.length||o("Name is required"),K.a.isEmail(n)||o("Valid email is required"),i&&o("Email already in use"),!a.length||!K.a.isEmail(n)||i){t.next=13;break}return j(!0),o(""),t.next=10,e.createUser(n,a);case 10:j(!1),localStorage.token=JSON.stringify(r),window.location.href=window.location.href;case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),O=r.name,f=r.email;return Object(S.jsx)(P.a,{component:"main",maxWidth:"xs",style:{marginBottom:"20px"},children:Object(S.jsxs)(V.a,{children:[Object(S.jsx)(B.a,{}),Object(S.jsxs)("div",{className:t.paper,children:[Object(S.jsx)(H.a,{className:t.avatar,children:Object(S.jsx)(L.a,{})}),Object(S.jsx)(R.a,{component:"h1",variant:"h5",children:"Sign in"}),Object(S.jsxs)("form",{className:t.form,noValidate:!0,children:[Object(S.jsx)($.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"name",label:"Name",name:"name",size:"small",autoFocus:!0,value:O,onChange:v,error:!(O||!u),helperText:!O&&u?"Please enter your name to enter into chat":null}),Object(S.jsx)($.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"email",label:"Email",type:"email",id:"email",size:"small",value:f,onChange:v,error:!(f||!u),helperText:!f&&u?"Please enter email address to enter into chat":null}),Object(S.jsx)(w.a,{type:"button",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,disabled:b,onClick:p,children:b?"Please wait...":"Submit"}),Object(S.jsx)("div",{style:{color:"red"},children:u})]})]}),Object(S.jsx)(Y.a,{mt:8,children:Object(S.jsx)(X,{})})]})})}var ie=Object(C.a)(Z||(Z=Object(q.a)(["\nquery {\n\tusers {\n\t\tid\n\t\tname\n\t\temail\n\t\tmessages {\n\t\t\tmessage\n\t\t\tsenderMail\n\t\t\treceiverMail\n\t\t}\n\t}\n}\n"]))),se=Object(C.a)(_||(_=Object(q.a)(["\nmutation($name: String!, $email: String!) {\n\tcreateUser(name: $name, email: $email) {\n\t\tname\n\t\temail\n\t\tid\n\t\tmessages {\n\t\t\tmessage\n\t\t\tsenderMail\n\t\t\treceiverMail\n\t\t}\n\t}\n}\n"]))),ce=Object(C.a)(ee||(ee=Object(q.a)(["\nmutation($email: String!) {\n\tdeleteUser(email: $email)\n}\n"]))),le=Object(C.a)(te||(te=Object(q.a)(["\nsubscription {\n\tnewUser {\n\t\tname\n\t\temail\n\t\tid\n\t\tmessages {\n\t\t\tmessage\n\t\t\tsenderMail\n\t\t\treceiverMail\n\t\t\ttimestamp\n\t\t}\n\t}\n}\n"]))),ue=Object(C.a)(ae||(ae=Object(q.a)(["\nsubscription {\n\toldUser\n}\n"]))),oe=Object(k.flowRight)(Object(d.b)(ie),Object(d.b)(se,{name:"createUser"}),Object(d.b)(ce,{name:"deleteUser"}))((function(e){var t=localStorage.getItem("token")&&JSON.parse(localStorage.getItem("token"))||{},a=Object(l.useState)({receiverMail:"",receiverName:""}),n=Object(M.a)(a,2),r=n[0],i=n[1],s=Object(l.useState)(""),c=Object(M.a)(s,2),u=c[0],o=c[1],m=Object(l.useState)(!1),d=Object(M.a)(m,2),b=d[0],j=d[1];Object(l.useEffect)((function(){var t=e.data.subscribeToMore;t({document:le,updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.newUser;return e.users.find((function(e){return e.id===n.id}))?e:Object(y.a)(Object(y.a)({},e),{},{users:[].concat(Object(x.a)(e.users),[n])})}}),t({document:ue,updateQuery:function(e,t){var a=t.subscriptionData;if(!a.data)return e;var n=a.data.oldUser;if(e.users.some((function(e){return e.email===n}))){var r=e.users.filter((function(e){return e.email!==n}));return e.users=r,e}return o(n),e}})}),[e.data]);var v=function(){var t=Object(h.a)(g.a.mark((function t(a,n){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.createUser({variables:{email:a,name:n},update:function(e,t){var a=t.data.createUser,n=e.readQuery({query:ie});n.users.find((function(e){return e.id===a.id}))||n.users.push(a),e.writeQuery({query:ie,data:n})}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),p=function(){var t=Object(h.a)(g.a.mark((function t(a){return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return localStorage.removeItem("token"),t.next=3,e.deleteUser({variables:{email:a},update:function(e){var t=e.readQuery({query:ie});t.users=t.users.filter((function(e){return e.email!==a})),e.writeQuery({query:ie,data:t})}});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),O=r.receiverMail,f=r.receiverName,w=e.data,k=w.users,$=w.error;return w.loading||$?null:localStorage.getItem("token")?Object(S.jsxs)("div",{className:"chat-page",children:[Object(S.jsx)(N,{style:{display:b?"none":"block"},users:k,email:t.email,name:t.name,selectedMail:function(e,t){i((function(a){return Object(y.a)(Object(y.a)({},a),{},{receiverMail:e,receiverName:t})})),j(!b)},deleteUser:p}),Object(S.jsx)(W,{style:{display:b?"block":"none"},email:t.email,receiverMail:O,receiverName:f,userLeft:u,name:t.name,setStyle:function(){j(!b)}})]}):Object(S.jsx)(re,{users:k,createUser:v})})),me=(a(203),new j.a({uri:"http://manojspace.com:4000/"})),de=new v.a({uri:"ws://manojspace.com:4000/",options:{reconnect:!0,lazy:!0,inactivityTimeout:3e4}}),be=Object(b.d)((function(e){var t=e.query,a=Object(p.l)(t),n=a.kind,r=a.operation;return"OperationDefinition"===n&&"subscription"===r}),de,me),je=new m.c({link:be,cache:new O.a});o.a.render(Object(S.jsx)(d.a,{client:je,children:Object(S.jsx)(oe,{})}),document.getElementById("root"))}},[[212,1,2]]]);
//# sourceMappingURL=main.5d2c0676.chunk.js.map